
<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>可新增刪除分頁的工作紀錄表</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f9f9f9; }
    h2 { color: #2c3e50; text-align: center; }
    .tab-section { text-align: center; margin-bottom: 15px; }
    .tab-buttons button {
      padding: 8px 16px; margin: 4px 3px;
      background: #3498db; color: #fff;
      border: none; border-radius: 4px; cursor: pointer;
    }
    .tab-buttons button.active { background: #2980b9; }
    .tab-add input { padding: 6px; width: 150px; }
    .tab-add button {
      padding: 6px 10px; margin-left: 5px;
      background: #2ecc71; color: #fff;
      border: none; border-radius: 4px;
    }
    .tab-buttons .tab-wrap { display: inline-block; margin: 3px; }
    .tab-buttons .tab-wrap span {
      background: #e74c3c; color: #fff;
      border-radius: 50%; padding: 2px 6px;
      font-size: 12px; cursor: pointer; margin-left: 5px;
      display: inline-block;
    }
    table { width: 100%; border-collapse: collapse; background: #fff; font-size: 0.95em; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background: #eaeaea; }
    td[contenteditable="true"] { background: #fdfdfd; }
    .add-task { margin-top: 15px; text-align: center; }
    button.add-btn {
      padding: 8px 16px; background: #2ecc71; color: #fff;
      border: none; border-radius: 4px; cursor: pointer;
    }
    button.delete-btn {
      background: #e74c3c; color: #fff; border: none;
      padding: 4px 8px; border-radius: 4px; cursor: pointer;
    }
    input[type="date"] { padding: 4px; }
    @media screen and (max-width: 600px) {
      table, thead, tbody, th, td, tr { display: block; width: 100%; }
      tr { margin-bottom: 10px; border: 1px solid #ccc; border-radius: 5px; background: #fff; }
      th { display: none; }
      td { text-align: left; padding: 10px; border: none; border-bottom: 1px solid #eee; }
    }
  </style>
</head>
<body>

<h2>分頁式工作紀錄表（可新增與刪除分頁）</h2>

<div class="tab-section">
  <div class="tab-buttons" id="tabs"></div>
  <div class="tab-add">
    <input type="text" id="newTabName" placeholder="輸入任務名稱" />
    <button onclick="createNewTab()">新增任務分頁</button>
  </div>
</div>

<table id="taskTable">
  <thead>
    <tr>
      <th>任務名稱</th>
      <th>負責人</th>
      <th>日期</th>
      <th>完成事項</th>
      <th>刪除</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<div class="add-task">
  <button class="add-btn" onclick="addTask()">➕ 新增紀錄</button>
</div>

<script>
  let currentTab = "";
  let taskData = {};

  function switchTab(tabName) {
    currentTab = tabName;
    renderTabs();
    renderTable();
  }

  function createNewTab() {
    const name = document.getElementById("newTabName").value.trim();
    if (!name) return alert("請輸入任務名稱");
    if (taskData[name]) return alert("這個任務已經存在！");
    taskData[name] = [];
    saveData();
    renderTabs();
    switchTab(name);
    document.getElementById("newTabName").value = "";
  }

  function deleteTab(tabName) {
    if (!confirm(`確定要刪除分頁「${tabName}」及其所有紀錄嗎？`)) return;
    delete taskData[tabName];
    saveData();
    const remainingTabs = Object.keys(taskData);
    if (remainingTabs.length === 0) {
      taskData["任務一"] = [];
    }
    renderTabs();
    switchTab(Object.keys(taskData)[0]);
  }

  function addTask(task = '', owner = '', date = '', note = '') {
    if (!taskData[currentTab]) taskData[currentTab] = [];
    taskData[currentTab].push({ task, owner, date, note });
    saveData();
    renderTable();
  }

  function deleteTask(index) {
    if (!confirm("確定要刪除這筆資料嗎？")) return;
    taskData[currentTab].splice(index, 1);
    saveData();
    renderTable();
  }

  function renderTable() {
    const tbody = document.querySelector("#taskTable tbody");
    tbody.innerHTML = "";
    const records = taskData[currentTab] || [];
    records.forEach((rec, index) => {
      const row = tbody.insertRow();
      const c1 = row.insertCell(0);
      const c2 = row.insertCell(1);
      const c3 = row.insertCell(2);
      const c4 = row.insertCell(3);
      const c5 = row.insertCell(4);

      c1.contentEditable = "true";
      c1.innerText = rec.task;
      c1.oninput = () => updateRecord(index, 0, c1.innerText);

      c2.contentEditable = "true";
      c2.innerText = rec.owner;
      c2.oninput = () => updateRecord(index, 1, c2.innerText);

      const dateInput = document.createElement("input");
      dateInput.type = "date";
      dateInput.value = rec.date;
      dateInput.onchange = () => updateRecord(index, 2, dateInput.value);
      c3.appendChild(dateInput);

      c4.contentEditable = "true";
      c4.innerText = rec.note;
      c4.oninput = () => updateRecord(index, 3, c4.innerText);

      const deleteBtn = document.createElement("button");
      deleteBtn.textContent = "刪除";
      deleteBtn.className = "delete-btn";
      deleteBtn.onclick = () => deleteTask(index);
      c5.appendChild(deleteBtn);
    });
  }

  function updateRecord(index, field, value) {
    const keys = ["task", "owner", "date", "note"];
    taskData[currentTab][index][keys[field]] = value;
    saveData();
  }

  function saveData() {
    localStorage.setItem("pagedWorkRecordsCustom", JSON.stringify(taskData));
  }

  function renderTabs() {
    const tabsDiv = document.getElementById("tabs");
    tabsDiv.innerHTML = "";
    Object.keys(taskData).forEach(tab => {
      const wrap = document.createElement("div");
      wrap.className = "tab-wrap";

      const btn = document.createElement("button");
      btn.textContent = tab;
      btn.onclick = () => switchTab(tab);
      if (tab === currentTab) btn.classList.add("active");

      const del = document.createElement("span");
      del.textContent = "×";
      del.title = "刪除分頁";
      del.onclick = () => deleteTab(tab);

      wrap.appendChild(btn);
      wrap.appendChild(del);
      tabsDiv.appendChild(wrap);
    });
  }

  function loadData() {
    taskData = JSON.parse(localStorage.getItem("pagedWorkRecordsCustom") || "{}");
    if (Object.keys(taskData).length === 0) {
      taskData["任務一"] = [];
    }
    renderTabs();
    switchTab(Object.keys(taskData)[0]);
  }

  window.onload = loadData;
</script>

</body>
</html>
